spring:
  application:
    name: emailagent

  main:
    # This project is intended to run as a one-off batch job (no embedded web server).
    web-application-type: none

  datasource:
    # =====================
    # PostgreSQL connection
    # =====================
    # Local defaults.
    # - In production, inject via env/secret manager instead of hardcoding
    # - pgvector requires `CREATE EXTENSION vector;` permission
    url: jdbc:postgresql://${DB_HOST:localhost}:${DB_PORT:5432}/${DB_NAME:emailagent}
    username: ${DB_USER:postgres}
    password: ${DB_PASSWORD:postgres}
    driver-class-name: org.postgresql.Driver

  jpa:
    # Disable Open Session In View to avoid unexpected lazy-loading queries.
    open-in-view: false
    hibernate:
      # Use validate because schema changes should be managed by Flyway.
      # Fails fast if entity mappings differ from DB schema.
      ddl-auto: validate
    properties:
      hibernate:
        format_sql: true
        # show_sql: true

  flyway:
    # =====================
    # DB migration
    # =====================
    enabled: true
    locations: classpath:db/migration

  ai:
    # =====================
    # Spring AI configuration guide
    # =====================
    # This section is a template.
    # - In practice you usually enable either OpenAI or Anthropic.
    # - Always inject API keys via environment variables.

    # 1) OpenAI
    openai:
      api-key: ${OPENAI_API_KEY:}
      embedding:
        options:
          model: text-embedding-3-large
      # chat:
      #   options:
      #     model: gpt-4o-mini


    # 2) Claude (Anthropic) - Will be used later if I decide to use anthropic models to generate email content.
#    anthropic:
#      api-key: ${ANTHROPIC_API_KEY:}
      # chat:
      #   options:
      #     model: claude-3-5-sonnet-latest

    # 3) VectorStore (pgvector)
    vectorstore:
      pgvector:
        # Whether to auto-create schema at runtime
        # - true: good for quick experiments
        # - false: recommended (manage schema with Flyway)
        initialize-schema: false

        # Table used by Spring AI pgvector VectorStore
        table-name: email_embeddings

        # Must match your embedding model dimension (e.g., 1536)
        dimensions: 1536

        # distance-type examples: cosine / l2 / inner_product
        # distance-type: cosine

gmail:
  enabled: ${GMAIL_ENABLED:true}
  oauth:
    client-id: ${GMAIL_CLIENT_ID:}
    client-secret: ${GMAIL_CLIENT_SECRET:}
    redirect-uri: ${GMAIL_REDIRECT_URI:}
    refresh-token: ${GMAIL_REFRESH_TOKEN:}

emailagent:
  runner:
    # Lookback window (hours) used in default mode.
    lookback-hours: ${EMAILAGENT_LOOKBACK_HOURS:1}

  ingestion:
    # <= 0 means "ingest all" (in practice: all in inbox)
    lookback-hours: ${EMAILAGENT_INGESTION_LOOKBACK_HOURS:0}

    # Safety limit: max messages to process per run
    max-messages: ${EMAILAGENT_INGESTION_MAX_MESSAGES:1000}

    # Gmail API list page size
    page-size: ${EMAILAGENT_INGESTION_PAGE_SIZE:20}

    # Chunking (to avoid embedding token limits)
    # - chunk-size: max characters per document chunk
    # - chunk-overlap: overlap between chunks
    chunk-size: ${EMAILAGENT_INGESTION_CHUNK_SIZE:4000}
    chunk-overlap: ${EMAILAGENT_INGESTION_CHUNK_OVERLAP:200}
